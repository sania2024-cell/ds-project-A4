<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapbox Test - Property Finder</title>
    <script src="config.js"></script>
    <script
        src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css'
        rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        #map {
            width: 100%;
            height: 400px;
            border-radius: 8px;
        }

        .instructions {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="instructions">
        <h2>üó∫Ô∏è Mapbox Configuration Test</h2>
        <p><strong>Testing your Mapbox integration:</strong></p>
        <ul>
            <li>‚úÖ Using token from <code>config.js</code></li>
            <li>‚úÖ Testing map load and controls</li>
            <li>‚úÖ Verifying India-focused view</li>
            <li>‚úÖ Testing marker and popup functionality</li>
        </ul>
        <p><em>If the map loads successfully below, your Property Finder app is
                ready!</em></p>
    </div>

    <div id="map"></div>
    <div id="status"></div>

    <script>
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.innerHTML = `<div class="${isError ? 'error' : 'success'}">${message}</div>`;
        }

        function initMap() {
            // Check if config is loaded
            if (typeof CONFIG === 'undefined') {
                showStatus('‚ùå Config.js not loaded. Please ensure config.js is in the same directory.', true);
                return;
            }

            const MAPBOX_TOKEN = CONFIG.MAPBOX_ACCESS_TOKEN;

            if (!MAPBOX_TOKEN || MAPBOX_TOKEN === 'YOUR_MAPBOX_ACCESS_TOKEN_HERE') {
                showStatus('‚ùå Please set your Mapbox token in config.js and refresh', true);
                return;
            }

            showStatus('üîÑ Loading map with your Mapbox token...');

            try {
                mapboxgl.accessToken = MAPBOX_TOKEN;

                const map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/streets-v12',
                    center: CONFIG.DEFAULT_MAP_CENTER, // Using config values
                    zoom: CONFIG.DEFAULT_MAP_ZOOM
                });

                // Add all the controls that will be in your main app
                map.addControl(new mapboxgl.NavigationControl(), 'top-right');
                map.addControl(new mapboxgl.FullscreenControl(), 'top-right');
                map.addControl(new mapboxgl.ScaleControl(), 'bottom-left');
                map.addControl(new mapboxgl.GeolocateControl({
                    positionOptions: { enableHighAccuracy: true },
                    trackUserLocation: true,
                    showUserHeading: true
                }), 'top-right');

                map.on('load', () => {
                    showStatus('‚úÖ Map loaded successfully! All controls added. Your Property Finder is ready! üéâ');

                    // Add sample property markers to test the styling
                    addSampleMarkers(map);
                });

                map.on('error', (e) => {
                    showStatus('‚ùå Map error: ' + e.error.message, true);
                });

                // Test map click functionality
                map.on('click', (e) => {
                    console.log('Map clicked at:', e.lngLat.lng, e.lngLat.lat);
                    showStatus(`üìç Map clicked at: ${e.lngLat.lat.toFixed(4)}, ${e.lngLat.lng.toFixed(4)}`);
                });

            } catch (error) {
                showStatus('‚ùå Failed to initialize map: ' + error.message, true);
            }
        }

        function addSampleMarkers(map) {
            // Sample properties to test marker styling (matching your app's style)
            const sampleProperties = [
                {
                    lng: 77.1025, lat: 28.7041,
                    price: 5000000, type: '3BHK',
                    title: 'Luxury Apartment in Delhi',
                    area: 'Connaught Place'
                },
                {
                    lng: 72.8777, lat: 19.0760,
                    price: 8500000, type: '2BHK',
                    title: 'Sea View Apartment in Mumbai',
                    area: 'Marine Drive'
                },
                {
                    lng: 77.5946, lat: 12.9716,
                    price: 3500000, type: '4BHK',
                    title: 'Tech City Villa in Bangalore',
                    area: 'Whitefield'
                }
            ];

            sampleProperties.forEach(property => {
                // Create custom marker HTML (matching your app's style)
                const markerElement = document.createElement('div');
                markerElement.style.cssText = `
                    background: linear-gradient(135deg, #3498db, #2980b9);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 20px;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                    border: 2px solid white;
                    font-size: 12px;
                    text-align: center;
                    min-width: 80px;
                    cursor: pointer;
                    font-weight: bold;
                    transform: translateY(-50%);
                `;
                markerElement.innerHTML = `
                    <div>‚Çπ${(property.price / 100000).toFixed(1)}L</div>
                    <div style="font-size: 10px; opacity: 0.9;">${property.type}</div>
                `;

                // Create popup
                const popup = new mapboxgl.Popup({ offset: 25 })
                    .setHTML(`
                        <div style="padding: 15px; min-width: 200px;">
                            <h3 style="margin: 0 0 10px 0; color: #2c3e50;">${property.title}</h3>
                            <p style="margin: 5px 0;"><strong>Price:</strong> ‚Çπ${(property.price / 100000).toFixed(1)} Lakhs</p>
                            <p style="margin: 5px 0;"><strong>Location:</strong> ${property.area}</p>
                            <p style="margin: 5px 0;"><strong>Type:</strong> ${property.type}</p>
                            <button style="background: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px; width: 100%;">View Details</button>
                        </div>
                    `);

                // Add marker to map
                new mapboxgl.Marker(markerElement)
                    .setLngLat([property.lng, property.lat])
                    .setPopup(popup)
                    .addTo(map);
            });
        }

        // Initialize map when page loads
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>

</html>